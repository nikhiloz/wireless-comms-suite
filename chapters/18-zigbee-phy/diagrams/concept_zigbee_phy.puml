@startuml concept_zigbee_phy
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Monospaced
skinparam rectangleBorderColor #333333
skinparam arrowColor #2266AA
skinparam titleFontSize 18

title Zigbee / IEEE 802.15.4 — 2.4 GHz PHY Chain

rectangle "**Data Bytes**\n(PSDU)" as data #E8F5E9

rectangle "**4-bit → 32-chip\nDSSS Mapping**" as dsss #FFF3E0 {
    note bottom
      zigbee_chip_map(symbol, chips)
      Each nibble (4 bits) → 32 PN chips
      16 unique spreading sequences
      Processing gain: 10·log₁₀(8) = 9 dB
      Chip rate: 2 Mchip/s → 250 kbps data
    end note
}

rectangle "**O-QPSK Modulator**" as oqpsk #E3F2FD {
    note bottom
      Even chips → I channel
      Odd chips  → Q channel (½ chip delay)
      Half-sine pulse shaping
      Constant envelope → efficient PA
      Offset prevents 180° transitions
    end note
}

rectangle "**PPDU Structure**" as ppdu #F3E5F5 {
    rectangle "SHR\n(Preamble)" as shr #E1BEE7
    note bottom of shr
      32 zero-symbols (4 bytes)
      8-bit SFD = 0xA7
    end note

    rectangle "PHR\n(Frame Length)" as phr #CE93D8
    rectangle "PSDU\n(Payload)" as psdu #BA68C8

    shr -right-> phr
    phr -right-> psdu
}

rectangle "**IQ Baseband**" as iq #E8F5E9

data -down-> dsss : "nibbles"
dsss -down-> oqpsk : "±1 chips"
oqpsk -down-> iq : "complex samples"
ppdu -down-> iq : "zigbee_build_ppdu()"

@enduml
